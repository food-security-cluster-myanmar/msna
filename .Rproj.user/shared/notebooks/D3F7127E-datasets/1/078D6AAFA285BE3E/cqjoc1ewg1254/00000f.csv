"0",""
"0","ifpri %>% "
"0","  filter(str_detect(var, ""b_|k_|f_01_|f_05_|j_01|j_07|j_08|l2_|k_|e_01|e_03|e_05|e_06|e_07|n_"")) %>% "
"0","  replace_na(list(value = 0)) %>% "
"0","  select(hhid, var, value) %>% "
"0","  pivot_wider(names_from = var, values_from = value) %>% "
"0","  arrange(hhid) %>% "
"0","  cbind(ifpri %>%"
"0","          pivot_wider(names_from = var, values_from = val) %>% "
"0","          arrange(hhid) %>%"
"0","          select(state, township_code) %>% "
"0","          filter(!is.na(state))) %>% "
"0","  select(-matches(""j_02_99"")) %>% "
"0","  # select(-starts_with(""k_02_|k_04_"")) %>% "
"0","  mutate(fcs_vegetables = pmax(l2_vegetables1, l2_vegetables2, l2_vegetables3, na.rm = TRUE), "
"0","         fcs_staples = pmax(l2_staples1, l2_staples2, na.rm = TRUE), "
"0","         fcs_protein = pmax(l2_protein_meat, l2_protein_seafood, l2_protein_eggs,"
"0","                           na.rm = TRUE), "
"0","         fcs_pulses = pmax(l2_pulses1, l2_pulses2, na.rm = TRUE), "
"0","         fcs_fruits = pmax(l2_fruits1, l2_fruits2, na.rm = TRUE)) %>% "
"0","  rename(fcs_sugar = l2_sugar, "
"0","         fcs_fat = l2_fat, "
"0","         fcs_dairy = l2_dairy1) %>% "
"0","  mutate(hhfcs = "
"0","           (fcs_sugar * .5 + fcs_fat * .5) + "
"0","           (fcs_vegetables + fcs_fruits) + "
"0","           (fcs_staples * 2) + "
"0","           (fcs_pulses * 3) + "
"0","           (fcs_protein * 4 + fcs_dairy * 4), "
"0","         hhfcs_inv = range_wna(hhfcs))  %>% "
"0","  mutate(b_08 = recode(b_08, `20` = 10), "
"0","         education_level = range_wna(abs(19 - b_08)), "
"0","         physical_security = recode(j_08, `9997` = 4), "
"0","         physical_security = range_wna(abs(4 - physical_security))) %>% "
"0","  mutate(rural_urban = ifelse(b_07 == 1, ""rural"", ""urban""), "
"0","         rural = ifelse(b_07 == 1, 1, 0)) %>% "
"0","  mutate(natural_hazards = ifelse(j_01 == 1, 1, 0)) %>% "
"0","  mutate_at(vars(k_01_sell_assets,"
"0","           k_03_mortgage_assets, "
"0","           k_05_consumed_seed_stock, "
"0","           k_06_reduced_agriculture, "
"0","           k_07_spend_savings, "
"0","           k_08_reduced_healthcare, "
"0","           k_09_reduced_nfi, "
"0","           k_10_reduced_food, "
"0","           k_11_borrow_food, "
"0","           k_12_borrow_money, "
"0","           k_13_migrate,"
"0","           k_14_children_work,"
"0","           k_15_risky_activity), "
"0","           ~ ifelse(.x > 100, 0, .x)) %>% "
"0","  mutate_at(vars(k_01_sell_assets:k_15_risky_activity), "
"0","            ~ case_when(. == 1 ~ 1, "
"0","                        . == 2 ~ 0, "
"0","                        . == 3 ~ 1,"
"0","                        TRUE ~ 0)) %>% "
"0","  mutate(csi_unweighted = "
"0","           k_01_sell_assets +"
"0","           k_03_mortgage_assets + "
"0","           k_05_consumed_seed_stock + "
"0","           k_06_reduced_agriculture + "
"0","           k_07_spend_savings + "
"0","           k_08_reduced_healthcare + "
"0","           k_09_reduced_nfi + "
"0","           k_10_reduced_food + "
"0","           k_11_borrow_food + "
"0","           k_12_borrow_money + "
"0","           k_13_migrate +"
"0","           k_14_children_work +"
"0","           k_15_risky_activity, "
"0","         csi_weighted ="
"0","           (k_01_sell_assets +"
"0","              k_03_mortgage_assets +"
"0","              k_05_consumed_seed_stock + "
"0","              k_06_reduced_agriculture +"
"0","              k_07_spend_savings +"
"0","              k_08_reduced_healthcare +"
"0","              k_09_reduced_nfi + "
"0","              k_12_borrow_money) * .5 + "
"0","           (k_10_reduced_food + "
"0","           k_11_borrow_food + "
"0","           k_13_migrate + "
"0","           k_14_children_work + "
"0","           k_15_risky_activity) * 1) %>%  "
"0","  mutate(csi_emergency = ifelse(k_10_reduced_food == 1 | "
"0","                                  k_11_borrow_food == 1 |"
"0","                                  k_13_migrate == 1 | "
"0","                                  k_14_children_work == 1 | "
"0","                                  k_15_risky_activity == 1, "
"0","                                ""emergency"", "
"0","                                ""non_emegency"")) %>% "
"0","  mutate(not_improved_floor = ifelse(e_03 %in% c(2), "
"0","                                     1, 0), "
"0","         not_improved_water = ifelse(e_05 %in% c(6, 7, 8, 9, 9999), "
"0","                                     1, 0), "
"0","         not_improved_sanitation = ifelse(e_06 %in% c(3, 4, 5, 9999),  "
"0","                                          1, 0), "
"0","         no_electricity = ifelse(e_07 %in% c(9, 9999, 9997, 9998, 9997), 1, 0)) %>% "
"0","  mutate(not_improved_housing = ifelse(e_01 %in% c(2, 6, 7), 1, 0)) %>% "
"0","  mutate_at(vars(n_01, n_03, n_05), "
"0","            ~ case_when(.x == 1 ~ 1, "
"0","                        .x == 2 ~ 0,"
"0","                        TRUE ~ 0)) %>% "
"0","  mutate_at(vars(n_02, n_04, n_06), "
"0","            ~ case_when(.x == 1 ~ 1.5, "
"0","                        .x == 2 ~ 6.5, "
"0","                        .x == 3 ~ 10)) %>% "
"0","  # mutate_at(vars(n_02, n_04, n_06), "
"0","  #         ~ range_wna(.)) %>% "
"0","  mutate(state = recode(state, "
"0","                        `1` = ""Kachin"","
"0","                        `2` = ""Kayah"","
"0","                        `3` = ""Kayin"","
"0","                        `4` = ""Chin"","
"0","                        `5` = ""Sagaing"","
"0","                        `6` = ""Tanintharyi"","
"0","                        `7` = ""Bago"","
"0","                        `8` = ""Magway"","
"0","                        `9` = ""Mandalay"","
"0","                        `10` = ""Mon"","
"0","                        `11` = ""Rakhine"","
"0","                        `12` = ""Yangon"","
"0","                        `14` = ""Ayeyarwady"","
"0","                        `15` = ""Nay Pyi Taw"","
"0","                        `131` = ""Shan (North)"","
"0","                        `132` = ""Shan (East)"","
"0","                        `133` = ""Shan (South)"")) %>% "
"0","  mutate(insecure = ifelse(physical_security > 0.34, 1, 0), "
"0","         count = 1) %>% "
"0","  write_csv(""./data/mini.csv"")"
