---
title: "DRAFT Initial Findings MSNA, FAO/WFP IFPRI survey review"
author: "[Myanmar Food Security Cluster](https://github.com/food-security-cluster-myanmar)"
date: "08/09/2022"
output: 
  html_document:
    code_download: true
    theme: readable
    toc: true
    toc_depth: 4
    toc_float: true
    number_sections: false
    collapsed: false
always_allow_html: true   
---

```{css, echo=FALSE}

#TOC::before {
  content: "";
  display: block;
  height: 70px;
  margin: 2em 20px 40px 20px;
  background-image: url("Myanmar_cluster_blue.png");
  background-size: contain;
  background-position: center center;
  background-repeat: no-repeat;
}
```

```{=html}
<style>
    body .main-container {
        max-width: 1280px;
    }
</style>
```


```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(scales)
library(janitor)
library(haven)
library(psych)
library(skimr)
library(mdepriv)
library(broom)
library(readxl)
library(widyr)
library(DT)
library(viridis)
library(corrplot)
library(rpart)
library(rpart.utils)
library(rattle)
library(rpart.plot)
library(randomForest)
library(broomstick)
library(patchwork)
library(tidymodels)
library(vip)
library(glmnet)
library(tidytext)
library(flextable)
library(skimr)
library(RColorBrewer)
library(lubridate)

range01 <- function(x){(x-min(x))/(max(x)-min(x))}
range_wna <- function(x){(x-min(x, na.rm = TRUE))/(max(x, na.rm = TRUE)-min(x, na.rm = TRUE))}

mode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}

opts <- options(knitr.kable.NA = "")

`%out%` <- Negate(`%in%`)

# disabling scientific notation
options(scipen = 999)

theme_set(theme_light())
```



<br><br><br>

## A. Data

### References for this report

* ACLED, (2022). ACLED data for Myanmar (2010-2022). Retrieved from https://acleddata.com on 2022-06-06. 
* International Food Policy Research Institute (2022). Myanmar Household Welfare Survey (MHWS), Round 1. Harvard Dataverse, doi: 10.7910/DVN/1R3F3U,. Retrieved from https://doi.org/10.7910/DVN/1R3F3U on 2022-09-01. 
* FAO and WFP (2022). Food Security Monitoring Survey Round 3. FAO and WFP. 
* Food Security Cluster Myanmar (2022). Township Prioritisation. https://food-security-cluster-myanmar.github.io/mmr_township_prioritisation/. 
* Food Security Cluster, Myanmar (2022). Understanding Conflict Dynamics in Myanmar through Conflict and Incident Data: A Food Security Perspective. https://food-security-cluster-myanmar.github.io/exploratory-data-analysis-acled-fsc/.
* HARP-F and MIMU (2018). Vulnerability in Myanmar: A Secondary Data Review of Needs, Coverage and Gaps. http://themimu.info/vulnerability-in-myanmar.
* REACH (2022). Myanmar Multi-sector Needs Assessment. REACH. 



```{r data, message=FALSE, warning=FALSE}

pcodes <- read_excel("./data/Myanmar PCodes Release_9.3_Jan2021_(StRgn_Dist_Tsp_Town_Ward_VT).xlsx",
                     sheet = "03_Township") 

acled <- read_csv("./data/acled_20220606.csv") %>% 
  left_join(pcodes %>% select(admin3_pcode = Tsp_Pcode, 
                             admin2_pcode = `District/SAZ_Pcode`, 
                             admin2 = `District/SAZ_Name_Eng`,
                             admin1_pcode = SR_Pcode),
            by = "admin3_pcode") %>% 
  rename(admin2 = admin2.y) %>% 
  filter(year >= 2021) 

conflict_score <-  read_csv("https://github.com/food-security-cluster-myanmar/mmr_township_prioritisation/blob/main/data/conflict_score2.csv") 

pin <- read_csv("./data/fs_pin.csv") 

codebook_ifpri <- read_csv("./data/mhws_rd1_codebook.csv") %>% clean_names

ifpri_raw <- read_dta("./data/mhws_rd1.dta") %>% zap_labels()

survey <- read_csv("./data/survey3.csv")

survey_mini <- read_csv("./data/survey_mini.csv")

mini <- read_csv("./data/mini.csv")

msna <- read_csv("./data/msna.csv")


```

<br>

The samples for the surveys examined are below. The date shown was the approximate mid-point of each survey. 

<br>

```{r}

rbind(
    
survey %>% 
  summarise(sample = n()) %>% 
  mutate(survey = "FAO_WFP", 
         date = ymd("2022-04-01")), 

mini %>% 
  summarise(sample = n()) %>% 
  mutate(survey = "IFPRI", 
         date = ymd("2022-01-01")), 

msna %>% 
  summarise(sample = n()) %>% 
  mutate(survey = "MSNA", 
         date = ymd("2022-08-01")) 
  ) %>% 
  arrange(date) %>% 
  mutate(date = format(date, "%Y-%m")) %>% 
  select(date, survey, sample) %>% 
  flextable() %>% 
  theme_zebra() %>% 
  set_table_properties(layout = "autofit", 
                       width = .4) %>% 
  set_caption("Survey samples")
```


<br><br><br>

## B. Initial findings

This draft report has been a cursory examination of the areas of convergence and consistency between the REACH Multi-sector Needs Assessment, the IFPRI Household Welfare Survey and the FAO/WFP Food Security Monitoring Survey.

<br><br><br>

## 1. Food consumption scores

### 1.1 Histograms of food consumption scores 

This is a good looking, quite normal distribution of food consumption scores. 

<br>

```{r warning=FALSE}
msna %>% 
  ggplot(aes(x = fs_calculated_fcs)) + 
  geom_histogram(bins=30) + 
  geom_freqpoly(binwidth = 2, 
                colour = "red", 
                alpha = .7) +
   labs(x = "Food consumption score", 
       y = "Number of households", 
       title = "Normal distribution of food consumption scores", 
       subtitle = "MSNA", 
       caption = "Myanmar Multi-sector Needs Assessment, REACH 2022")
```

<br>

Though, of course, the distribution curve in IFPRI's survey is still better looking.  

<br>

```{r}
mini %>% 
  ggplot(aes(x = hhfcs)) + 
  geom_histogram(bins=30) + 
  geom_freqpoly(binwidth = 2, 
                colour = "red",
                alpha = .7) + 
  labs(x = "Food consumption score", 
       y = "Number of households", 
       title = "Normal distribution of food consumption scores", 
       subtitle = "IFPRI", 
       caption = "Household Welfare Survey, IFPRI 2022")

```

<br>



For reference, the distribution of food consumption scores in the surveyed population of the FAO/WFP survey looks like this, a bit more skewed and misshapen, probably due to the smaller sample size. 

It is also important to note how much more definition there is in the lower end of the spectrum in the MSNA and IFPRI compared to the FAO/WFP survey.

<br>

```{r}
survey %>% 
  ggplot(aes(x = hhfcs)) + 
  geom_histogram(bins=30) +
  geom_freqpoly(binwidth = 2, 
                colour = "red",
                alpha = .7) + 
  labs(x = "Food consumption score", 
       y = "Number of households", 
       title = "Distribution of food consumption scores", 
       subtitle = "FAO/WFP round 3", 
       caption = "FAO/WFP food security survey round 3 2022")
```

<br>

As a purely academic point of reference, since much more work needs to be done one this, but there does seem to have been an increase in the percentage of the population with borderline and poor FCS scores compared to round 3 of the FAO/WFP survey. This would imply an increase in the PIN. 

However, a lot of the fluctuation has to do with seasonality, so it is best to hold off until round 4 is ready to explore this further. 


<br> 

```{r}
survey %>% select(fcs_borderline_poor) %>% 
  summarise(fcs_borderline_poor = sum(fcs_borderline_poor), 
            count = n()) %>% 
  mutate(borderline_poor_unweighted = fcs_borderline_poor / count,) %>% 
  select(borderline_poor_unweighted) %>% 
  mutate_all(~round(. * 100, digits = 2)) %>% 
  mutate(survey = "IFPRI") %>% 
rbind(
  
mini %>% 
  mutate(fcs_borderline_poor = ifelse(hhfcs <= 35, 
                                      1, 0)) %>% 
 #  left_join(ifpri_raw %>% 
 #              select(hhid, hhweight), 
 #            by = "hhid") %>% 
 #  select(hhweight, fcs_borderline_poor) %>% 
 #  mutate(weighted = ifelse(fcs_borderline_poor == 1, 
 #                           hhweight, 0), 
 #         count = 1) %>% 
  summarise(fcs_borderline_poor = sum(fcs_borderline_poor), 
            count = n()) %>% 
  mutate(borderline_poor_unweighted = fcs_borderline_poor / count) %>% 
  select(borderline_poor_unweighted) %>% 
  mutate_all(~round(. * 100, digits = 2)) %>% 
  mutate(survey = "FAO/WFP"), 

msna %>% 
  mutate(fcs_borderline_poor = ifelse(fs_calculated_fcs <= 35,
                                      1, 0)) %>% 
  summarise(fcs_borderline_poor = sum(fcs_borderline_poor, na.rm = TRUE), 
            count = n()) %>% 
  mutate(borderline_poor_unweighted = fcs_borderline_poor / count) %>% 
  select(borderline_poor_unweighted) %>% 
  mutate_all(~round(. * 100, digits = 2)) %>% 
  mutate(survey = "MSNA")

) %>% 
  relocate(survey) %>% 
  mutate(date = (ymd(c("2022-01-01", 
                      "2022-04-01", 
                      "2022-08-01"))), 
         date = format(date, "%Y-%m")) %>% 
  flextable() %>% 
  theme_zebra() %>% 
  set_table_properties(layout = "autofit", 
                       width = .5) %>% 
  set_caption("Percentage of surveyed population with borderline or poor FCS")
   
```


<br><br>

### 1.2 Correlation plots - FCS components

This section examines the relationships between the consumption of the various food groups. Similarities across all surveys include the rectangular relationship between protein, sugar, fruit and dairy consumption. 

<br>

```{r message=FALSE, warning=FALSE}
mini %>% 
  select(matches("fcs")) %>% 
  select(-c(hhfcs, hhfcs_inv)) %>% 
  rename_all(funs(
    str_remove_all(., "fcs_")
  )) %>% 
  cor(method = c("pearson")) %>% 
  corrplot(type = "upper", 
           col = brewer.pal(n = 13, 
                            name = "RdBu"), 
           tl.srt = 55, 
           title = "Correlation plot - food consumption indicators, IFPRI", 
           mar = c(0, 0, 2, 0), 
           diag = FALSE, 
           addCoef.col = 1, 
           number.cex = .3,
           tl.cex = .5)

```

<br>

It is suspected that this shows a pattern of behaviour amongst those more affluent. 

<br>

```{r message=FALSE, warning=FALSE}
survey %>% 
  select(matches("fcs")) %>% 
  select(-c(fcs_borderline_poor, hhfcs, hhfcs_inv, notefcs)) %>% 
  rename_all(list(~ str_remove_all(.x, "fcs_"))) %>% 
  select(dairy, sugar, fat, 
         vegetables = veg, staples = stap, 
         proteins = pr, pulses = pulse, 
         fruits = fruit) %>% 
  cor(method = c("pearson")) %>% 
  corrplot(type = "upper", 
           col = brewer.pal(n = 13, 
                            name = "RdBu"), 
           tl.srt = 55, 
           title = "Correlation plot - food consumption indicators, FAO/WFP", 
           mar = c(0, 0, 2, 0), 
           diag = FALSE, 
           addCoef.col = 1, 
           number.cex = .3,
           tl.cex = .5)
  


```
<br>

However, certain patterns are present in the MSNA that are not reflected in the other surveys. Fats appear to be very well correlated with many of the other food groups.

For some reason, correlations are much stronger in the MSNA dataset. 

<br>

```{r message=FALSE, warning=FALSE}
msna %>% 
  select(contains("fcs")) %>% 
  select(-c(fs_calculated_fcs, 
            hhfcs_inv)) %>% 
  drop_na() %>% 
  rename_all(funs(str_remove_all(., "fs_fcs_"))) %>% 
  select(dairy, sugar, fat, 
         vegetables = vegetableleave, 
         staples = cerealgrainroottuber, 
         proteins = meatfishegg, 
         pulses = beansnuts,
         fruits = fruit) %>% 
  cor(method = c("pearson")) %>% 
  corrplot(type = "upper", 
           col = brewer.pal(n = 13, 
                            name = "RdBu"), 
           tl.srt = 55, 
           title = "Correlation plot - food consumption indicators, MSNA", 
           mar = c(0, 0, 2, 0), 
           diag = FALSE, 
           addCoef.col = 1, 
           number.cex = .3,
           tl.cex = .5)

# dairy, sugar, fat, vegetables, staples, proteins, pulses, fruits
```

<br>

Ultimately, it would be useful to review the exact Myanmar wording and standardise that across these surveys so that we achieve more comparable results. I suspect that the language around fat is much better in the MSNA since we seem to getting a much more understandable result here. 

<br><br><br>


## 2. Education levels 

<br>

```{r}

mini %>% 
  mutate(one = 1, 
         count = sum(one), 
         pc = round(
           ifelse(one / count * 100 > 0, 
                  one / count * 100, 
                  0), 
                    digits = 2)) %>% 
  group_by(b_08) %>% 
  summarise(pc = sum(pc)) %>%  
  ggplot(aes(x = b_08, y = pc)) + 
  geom_col(fill = "grey20") + 
  geom_text(aes(label = pc), 
            colour = "white",
            size = 2.5, 
            position = position_stack(vjust = .5)) +
  scale_y_continuous(labels = comma) +  
  scale_x_continuous(breaks = seq(0, 20, by = 2)) + 
  labs(x = "Years of education", 
       y = "Percent of households", 
       title = "Years of education of IFPRI respondents, unweighted", 
       caption = "Household Welfare Survey, IFPRI 2022")
```

<br>

Common stopping points are near the end of primary school and secondary school. At the right end of the plot, the university-educated population is a noticeable minority. 

This corroborates with common understanding of the context in Myanmar and structure of the labour force. Education level is also one of the strongest predictors of resilience. 

This added level of detail is immediately much more useful at identifying populations in need of assistance and what types of targeted support would improve their circumstances.  

It is recommended that the FAO/WFP survey adopt the IFPRI convention for their survey, at least for this question. 

<br>

```{r}
survey %>% 
  select(survey_id, hoh_education) %>% 
  mutate(value = 1, 
         hoh_education = str_replace_all(hoh_education, 
                                         "edu_", ""), 
         hoh_education = fct_relevel(hoh_education, 
                                     c("none", 
                                       "primary", 
                                       "secondary", 
                                       "higher"))) %>% 
  arrange(hoh_education) %>% 
  filter(!is.na(hoh_education)) %>% 
  ungroup() %>% 
  group_by(hoh_education) %>% 
  summarise(value = sum(value)) %>% 
  mutate(pc = round(value / sum(value) * 100, 
                    digits = 2)) %>% 
  ggplot(aes(x = hoh_education, y = pc)) + 
  geom_col(fill = "grey20") + 
  geom_text(aes(label = pc), 
            vjust = 1, 
            colour = "white") +
  scale_y_continuous(labels = comma) + 
  labs(x = "Education level of household head", 
       y = "Number of households", 
       title = "Education level of household head, FAO/WFP survey round 3 2022")
  
```

<br> 

Using IFPRI's data, it is possible to identify the states and regions which have the highest number of persons without primary-school attainment, i.e. those who stopped at 5 years of schooling or less. 

<br>

```{r warning=FALSE}

mini %>% 
  mutate(low_education = ifelse(b_08 <= 5, 
                                "yes", "no")) %>% 
  group_by(state, low_education) %>% 
  summarise(count = n(), 
            .groups = "drop") %>% 
  group_by(state) %>% 
  mutate(pc = round(count / sum(count) * 100, 
                    digits = 2), 
         sort = ifelse(low_education == "yes", 
                       pc, 
                       NA_real_), 
         sort1 = sort) %>% 
  fill(sort1, .direction = c("up")) %>% 
  ggplot(aes(x = pc, 
             y = fct_reorder(state, sort1))) + 
  geom_col(aes(fill = low_education)) +
  geom_text(aes(label = sort), 
            size = 2.5, 
            hjust = "inward", 
            colour = "white", 
            position = position_dodge(width = .9)) +
  scale_fill_manual(values = c("#0099FF", "#000033")) + 
  labs(title = "% of population without primary school attainment", 
       subtitle = "IFPRI",
       x = "Percentage", 
       y = "", 
       fill = "no pri_sch\nattainment", 
       caption = "Myanmar Household Welfare Survey, IFPRI 2022")

```


<br>

The MSNA does not have such livelihoods-oriented questions; instead of education level of the household head, it is focused on current enrollment and attendance.  

Enrollment seems to be lowest where the fighting is heaviest. 

<br>

```{r}

msna %>% 
  filter(hh_number_girls_6_11_count > 0 | hh_number_boys_6_11_count > 0) %>%  
  group_by(state) %>% 
  summarise(girls_total = sum(hh_number_girls_6_11_count),
            girls_enrolled = sum(edu_enrol_girl_prim, na.rm = TRUE), 
            boys_total = sum(hh_number_boys_6_11_count), 
            boys_enrolled = sum(edu_enrol_boy_prim, na.rm = TRUE)) %>% 
  mutate(girls_6_11 = round(girls_enrolled / girls_total * 100, digits = 2), 
         boys_6_11 = round(boys_enrolled / boys_total * 100, digits = 2)) %>% 
  pivot_longer(cols = c(girls_6_11, boys_6_11), 
               names_to = "var", 
               values_to = "value") %>% 
  ggplot(aes(x = value, y = reorder_within(state, value, var))) + 
  geom_col(aes(fill = state), 
           alpha = .8) +
  geom_text(aes(label = value),
            colour = "grey20", 
            size = 3, 
            hjust = "inward") + 
  scale_fill_viridis_d() +
  scale_y_reordered() + 
  facet_wrap(~ var, scales = "free_y") + 
  theme(legend.position = "none",
    strip.text = element_text(size = 10, face = "bold"),
    strip.background = element_rect(fill = "#212121")) + 
  labs(x = "Percent enrolled", 
       y = "", 
       title = "States by primary school enrollment (primary)", 
       subtitle = "MSNA", 
       caption = "REACH 2022")
```

<br>

The same is true for upper and lower secondary enrollment. 

There is also a similar amount of detail on attendance. However, the very low enrollment in conflict-affected areas already provides a very clear priority for intervention. These overlap to a great extent with protection concerns. 

<br><br><br>


## 3. Conflict and Protection concerns 

### 3.1 Protection concerns

Protection concerns are extremely widespread.

<br>

```{r fig.height=8, fig.width=9}

msna %>%
  select(uuid, women = prot_security_concerns_women) %>% 
  mutate(women = str_replace_all(women, 
                                 "_", "")) %>%  
  unnest_tokens(word, women) %>% 
  group_by(word) %>% 
  summarise(count = n()) %>% 
  mutate(pc = round(count / sum(count) * 100, 
                    digits = 2), 
         word = fct_reorder(word, pc)) %>% 
  ggplot(aes(x = pc, 
             y = word)) + 
  geom_col(fill = "#1ABC9C") + 
  geom_text(aes(label = pc), 
            size = 2.5, 
            hjust = "inward") +
  labs(x = "Percentage of concerns", 
       y = "Protection concerns -- women", 
       title = "Protection concerns -- women, MSNA") +
  theme(plot.title = element_text(size = 10), 
        axis.title.y = element_text(size = 8), 
        axis.title.x = element_text(size = 8)) +

msna %>%
  select(uuid, men = prot_security_concerns_men) %>% 
  mutate(men = str_replace_all(men, 
                                 "_", "")) %>%  
  unnest_tokens(word, men) %>% 
  group_by(word) %>% 
  summarise(count = n()) %>% 
  mutate(pc = round(count / sum(count) * 100, 
                    digits = 2), 
         word = fct_reorder(word, pc)) %>% 
  ggplot(aes(x = pc, 
             y = word)) + 
  geom_col(fill = "#1ABC9C") + 
  geom_text(aes(label = pc), 
            size = 2.5, 
            hjust = "inward") +
  labs(x = "Percentage of concerns", 
       y = "Protection concerns -- men", 
       title = "Protection concerns -- men, MSNA") + 
  theme(plot.title = element_text(size = 10), 
        axis.title.y = element_text(size = 8), 
        axis.title.x = element_text(size = 8)) +

msna %>%
  select(uuid, girls = prot_security_concerns_girls) %>% 
  mutate(girls = str_replace_all(girls, 
                                 "_", "")) %>%  
  unnest_tokens(word, girls) %>% 
  group_by(word) %>% 
  summarise(count = n()) %>% 
  mutate(pc = round(count / sum(count) * 100, 
                    digits = 2), 
         word = fct_reorder(word, pc)) %>% 
  ggplot(aes(x = pc, 
             y = word)) + 
  geom_col(fill = "#1ABC9C") + 
  geom_text(aes(label = pc), 
            size = 2.5, 
            hjust = "inward") +
   labs(x = "Percentage of concerns", 
       y = "Protection concerns -- girls", 
       title = "Protection concerns -- girls, MSNA") + 
  theme(plot.title = element_text(size = 10), 
        axis.title.y = element_text(size = 8), 
        axis.title.x = element_text(size = 8)) +
  
msna %>%
  select(uuid, boys = prot_security_concerns_boys) %>% 
  mutate(boys = str_replace_all(boys, 
                                 "_", "")) %>%  
  unnest_tokens(word, boys) %>% 
  group_by(word) %>% 
  summarise(count = n()) %>% 
  mutate(pc = round(count / sum(count) * 100, 
                    digits = 2), 
         word = fct_reorder(word, pc)) %>% 
  ggplot(aes(x = pc, 
             y = word)) + 
  geom_col(fill = "#1ABC9C") + 
  geom_text(aes(label = pc), 
            size = 2.5, 
            hjust = "inward") +
   labs(x = "Percentage of concerns", 
       y = "Protection concerns -- boys", 
       title = "Protection concerns -- boys, MSNA") + 
  theme(plot.title = element_text(size = 10), 
        axis.title.y = element_text(size = 8), 
        axis.title.x = element_text(size = 8))

  
```



<br>

Overall, girls and women have more protection concerns than boys and men. Several concerns that should be highlighted: 5.28% of boys and 5.55% of men are concerned about being killed, for women and girls, it was 3.22% and 3.18% respectively. 

6.11% of men, 6.37% of boys, 4.9% of women and 4.78% of girls are concerned about being injured in an explosive attack. 

Women and girls are most concerned about being robbed, being sexually harassed and/or being threatened with violence. Men and boys are most concerned about being threatened with violence, being detained and being robbed.


<br>

```{r fig.height=9, fig.width=9}
msna %>%
  select(uuid,
         state, 
         boys = prot_security_concerns_boys, 
         girls = prot_security_concerns_girls, 
         men = prot_security_concerns_men, 
         women = prot_security_concerns_women) %>% 
  pivot_longer(cols = -c(uuid, state), 
               names_to = "group", 
               values_to = "concern") %>% 
  mutate(concern = str_replace_all(concern, 
                                   "_", "")) %>% 
  unnest_tokens(word, concern) %>% 
  group_by(word, state) %>% 
  summarise(count = n(), 
            .groups = "drop") %>% 
  group_by(state) %>% 
  mutate(pc = round(count / sum(count) * 100, 
                    digits = 2)) %>% 
  # filter(word != "none") %>% 
  top_n(7, wt = pc) %>%
  ggplot(aes(x = pc, 
             y = reorder_within(word, pc, state))) + 
  geom_col(fill = "#F9E79F") + 
  geom_text(aes(label = pc), 
            size = 2.5, 
            hjust = "inward") +
   labs(x = "Percentage of concerns", 
       y = "Protection concerns", 
       title = "Top 5 protection concerns by state, MSNA") + 
  scale_y_reordered() + 
  facet_wrap(~ state, 
             ncol = 3, 
             scales = "free_y") + 
   theme(legend.position = "none",
        strip.text = element_text(size = 8, face = "bold"),
        strip.background = element_rect(fill = "#212121"), 
        axis.text.y = element_text(size = 7), 
        axis.title.x = element_text(size = 8))
  
     
```


<br>

Ayeyarwady, Bago West and Nay Pyi Taw have the fewest protection concerns. 

Being threatened with violence is the top security concern in Sagaing, Kayah, Kachin, Chin, Shan North and Bago East. 

A significant minority of persons in Kayah, Kayin, Kachin, Chin, Shan North, Shan East and Sagaing is concerned with being recruited into the armed forces. Detention and being injured by explosives were other concerns conflict-affected areas. 

<br><br>

### 3.2 Conflict and insecurity

```{r  fig.width=10, fig.height=10}

ord <- c("Nay Pyi Taw",  "Bago", "Ayeyarwady", "Magway", "Shan (South)", "Tanintharyi",
         "Shan (East)", "Mandalay", "Mon", "Rakhine", "Sagaing", "Shan (North)",
         "Yangon",  "Kayin", "Chin", "Kachin", "Kayah")

mini %>% 
  group_by(state) %>% 
  summarise(count = sum(count), 
            insecure = sum(insecure)) %>% 
  mutate(pc_insecure = round(insecure / count * 100, 
                             digits = 2)) %>% 
  ungroup() %>% 
  mutate(state = fct_reorder(state, pc_insecure)) %>% 
  ggplot(aes(x = pc_insecure, y = state)) + 
  geom_col(fill = "grey70") + 
  geom_text(aes(label = pc_insecure),
            size = 2.5, 
            colour = "black", hjust = 1) +
  theme(legend.position = "none", 
        plot.title = element_text(size = 11), 
        axis.text.x = element_text(size = 8), 
        plot.caption = element_text(hjust = .5)) +
  labs(x = "Percentage of households", y = "", 
       title = "Percentage of households who feel insecure", 
       subtitle = "(somewhat and very), unweighted, IFPRI", 
       caption = "Myanmar Household Welfare Survey, IFPRI 2022")  + 
  
acled %>%
  group_by(admin1) %>% 
  summarise(fatalities = sum(fatalities)) %>% 
  right_join(pin %>%
               group_by(state) %>%
               summarise(population = sum(population_2021_proj)), 
             by = c("admin1" = "state")) %>% 
  mutate(admin1 = recode(admin1, 
                         "Bago (East)" = "Bago", 
                         "Bago (West)" = "Bago")) %>% 
  group_by(admin1) %>% 
  summarise(population = sum(population), 
            fatalities = sum(fatalities)) %>%
  ungroup() %>% 
  mutate(fatalities_pm = fatalities / population * 1000000, 
         fatalities_pm = round(fatalities_pm, digits = 0),
         admin1 = fct_relevel(admin1, ord)) %>% 
  arrange(admin1) %>% 
  ggplot(aes(x = fatalities_pm, y = admin1)) + 
  geom_col(fill = "grey70") + 
  geom_text(aes(label = comma(fatalities_pm, accuracy = 4)), 
                size = 2.5, 
                colour = "black", 
                hjust = "inward") + 
  theme(legend.position = "none", 
        plot.title = element_text(size = 11), 
        axis.text.x = element_text(size = 8), 
        plot.caption = element_text(hjust = .5)) +
  scale_x_continuous(labels = comma) + 
  labs(x = "Conflict fatalities per million persons", 
       y = "", 
       title = "Conflict FATALITIES per million persons", 
       subtitle = "as of 06-06-2022, ACLED", 
       caption = "ACLED; acleddata.com") + 
  
acled %>%
  group_by(admin1) %>% 
  filter(sub_event_type != "Peaceful protest") %>% 
  summarise(events = n()) %>% 
  right_join(pin %>%
               group_by(state) %>%
               summarise(population = sum(population_2021_proj)), 
             by = c("admin1" = "state")) %>% 
  mutate(admin1 = recode(admin1, 
                         "Bago (East)" = "Bago", 
                         "Bago (West)" = "Bago")) %>% 
  group_by(admin1) %>% 
  summarise(population = sum(population), 
            events = sum(events)) %>%
  ungroup() %>% 
  mutate(events_pm = events / population * 1000000, 
         events_pm = round(events_pm, digits = 0),
         admin1 = fct_relevel(admin1, ord)) %>% 
  arrange(admin1) %>% 
  ggplot(aes(x = events_pm, y = admin1)) + 
  geom_col(fill = "grey70") + 
  geom_text(aes(label = comma(events_pm, accuracy = 4)), 
                size = 2.5, 
                colour = "black", 
                hjust = "inward") + 
  theme(legend.position = "none", 
        plot.title = element_text(size = 11), 
        axis.text.x = element_text(size = 8), 
        plot.caption = element_text(hjust = .5)) + 
  scale_x_continuous(labels = comma) + 
  labs(x = "Conflict events per million persons", 
       y = "", 
       title = "Conflict EVENTS per million persons", 
       subtitle = "as of 06-06-2022, ACLED", 
       caption = "ACLED; acleddata.com") +
  
mini %>% 
  group_by(state) %>% 
  mutate(very_insecure = ifelse(physical_security > .67, 
                                1, 0)) %>% 
  summarise(count = sum(count), 
            very_insecure = sum(very_insecure)) %>% 
  mutate(pc_very_insecure = round(very_insecure / count * 100, 
                             digits = 2)) %>% 
  ungroup() %>% 
  mutate(state = fct_reorder(state, pc_very_insecure)) %>% 
  ggplot(aes(x = pc_very_insecure, y = state)) + 
  geom_col(fill = "grey70") + 
  geom_text(aes(label = pc_very_insecure),
            size = 2.5, 
            colour = "black", hjust = 1) +
  theme(legend.position = "none", 
        plot.title = element_text(size = 11), 
        axis.text.x = element_text(size = 8), 
        plot.caption = element_text(hjust = .5)) +
  labs(x = "Percentage of households", y = "", 
       title = "Percentage of households who feel VERY insecure", 
       subtitle = "Unweighted, IFPRI", 
       caption = "Myanmar Household Welfare Survey, IFPRI 2022")  + 
  
  plot_layout(ncol = 2, 
              heights = c(2, 2))

```

<br>

Nay Pyi Taw comes last after Ayeryarwady and Bago consistently across the IFPRI insecurity question and ACLED data. This is consistent with a broader understanding of the crisis.

Relatively high perceptions of insecurity in places like Shan (North) and Kachin remind us that many parts of these states have not so much improved, as opposed to the rest of the country having lurched into open civil war. This, of course, forestalls the long-term investment and peacebuilding efforts that are necessary to stabilise the country. 

In that case, working with the private sector becomes extremely necessary and the IFPRI should prove to be an excellent resource in identifying points of common interest. 

As perhaps one final comparison with the FAO/WFP survey, the question there is: 

>Has your household faced any particular disaster or crisis affecting your community or your household that affected your ability to raise an income and/or to produce food for self consumption in the last 3 months? 

And the option is at the end of an admittedly long list and fatigue might have set in on either the enumerator's or the respondent's parts: 

>22)Violence and insecurity / conflict

In round 3, **10%** of persons who were exposed to violence, insecurity and conflict. Which is slightly different from the **19%** of persons who say that they feel "insecure" or "somewhat insecure" in IFPRI. Overall, I prefer the IFPRI's approach since they have a dedicated question for insecurity, though, the MSNA provides much more detail, though adding so many protection questions might prove a challenge. 


```{r eval = FALSE}
mini %>% 
  summarise_at(vars(insecure, count), sum) %>% 
  mutate(insecure / count) %>% 
  mutate(pc_insecure = round(insecure / count, 
                             digits = 2)) 

survey %>% 
  mutate(count = 1) %>% 
  summarise_at(vars(shocks_conflict, count), sum) %>% 
  mutate(shocks_conflict / count) %>% 
  mutate(pc_insecure = round(shocks_conflict / count, 
                             digits = 2))

```


<br><br><br>

## 4. Coefficient plots -- food consumption score

Multicollinearity is a concern in the MSNA dataset. Below are a list of selected indicators chosen to avoid that.

<br>

```{r}
msna %>% 
  select(rural, 
         not_improved_housing,  
         not_improved_sanitation, 
         concern_violence, 
         hhfcs_inv,  
         edu_enrol_girl_prim) %>% 
  mutate_at(vars(edu_enrol_girl_prim), 
            ~ abs(1 - .x)) %>% 
  lm(hhfcs_inv ~ ., data = .) %>% 
  tidy(conf.int = TRUE) %>% 
  filter(term != "(Intercept)") %>%
  mutate(term = fct_reorder(term, estimate)) %>% 
  ggplot(aes(x = estimate, 
             y = term, 
             colour = estimate)) + 
  geom_vline(xintercept = 0, lty = 2, colour = "red") + 
  geom_point() + 
  geom_errorbarh(aes(xmin = conf.low, xmax = conf.high), height = 0.2) +
  scale_colour_viridis(option = "turbo") +
  theme(legend.position = "none",
          axis.text.y = element_text(size = 7),
          axis.title.x = element_text(size = 7, face = "bold")) +
  labs(x = "Estimate", y = "", 
       title = "Coefficient plot, household FCS with selected indicators", 
       subtitle = "MSNA", 
       caption = "Myanmar Multi-sector Needs Assessment, REACH 2022")
  

```

<br>

The pattern of relationships is not really borne out in the IFPRI or the FAO/WFP survey. All the indicators below are statistically significant except for exposure to natural hazards and unimproved drinking water (where perhaps the number of surveyed households who responded affirmatively was too low). 

<br>

```{r}
mini %>% 
  select(hhfcs_inv, education_level, physical_security, rural, 
         natural_hazards, not_improved_floor, not_improved_water, 
         not_improved_sanitation, not_improved_housing, 
         physical_security) %>% 
  # summarise_at(vars(hhfcs_inv:no_electricity), mean)
  lm(hhfcs_inv ~ ., data = .) %>% 
  tidy(conf.int = TRUE) %>% 
  filter(term != "(Intercept)") %>%
  mutate(term = fct_reorder(term, estimate)) %>% 
  ggplot(aes(x = estimate, 
             y = term, 
             colour = estimate)) + 
  geom_vline(xintercept = 0, lty = 2, colour = "red") + 
  geom_point() + 
  geom_errorbarh(aes(xmin = conf.low, xmax = conf.high), height = 0.2) +
  scale_colour_viridis(option = "turbo") +
  theme(legend.position = "none",
          axis.text.y = element_text(size = 7),
          axis.title.x = element_text(size = 7, face = "bold")) +
  labs(x = "Estimate", y = "", 
       title = "Coefficient plot, household FCS with selected indicators", 
       subtitle = "IFPRI", 
       caption = "Myanmar Household Welfare Survey, IFPRI 2022")

```

<br>

As expected, education levels would have the most positive impact on food consumption, whereas exposure to natural hazards consistently causes households to experience food insecurity. 

Similarly, all the indicators below, from the FAO/WFP food security survey, have a statistically-signifcant relationship with the food consumption score. 

Access to safe drinking water is a stronger predictor of low food consumption scores in both IFPRI and FAO/WFP. Likewise, the variable least associated with food insecurity would be high educational attainment of the household head. However, this variable not present in the MSNA dataset. 

The MSNA dataset needs to be examined in more detail. 


<br>

```{r}
survey_mini %>%
  left_join(survey %>% select(score = hhfcs_inv, survey_id), by = "survey_id") %>% 
  select(-survey_id, -matches("cs_|fies_|fcs_"), -tot_income) %>%
  lm(score ~ ., data = .) %>% 
  tidy(conf.int = TRUE) %>% 
  filter(term != "(Intercept)") %>%
  filter(p.value <= .05) %>% 
  mutate(term = fct_reorder(term, estimate)) %>% 
  ggplot(aes(x = estimate, 
             y = term, 
             colour = estimate)) + 
  geom_vline(xintercept = 0, lty = 2, colour = "red") + 
  geom_point() + 
  geom_errorbarh(aes(xmin = conf.low, xmax = conf.high), height = 0.2) +
  scale_colour_viridis(option = "turbo") +
  theme(legend.position = "none",
          axis.text.y = element_text(size = 7),
          axis.title.x = element_text(size = 7, face = "bold")) +
  labs(x = "Estimate", y = "", 
       title = "Coefficient plot, household FCS with selected indicators", 
       subtitle = "FAO/WFP", 
       caption = "FAO/WFP food security survey round 3 2022") 
```

<br><br><br>


## 5. Coping strategies index 

### 5.1 Distribution of coping strategies index scores

The distribution of coping strategies index scores in the MSNA is less than desirable. 

<br>

```{r}
msna %>% 
  mutate_at(vars(liv_crisis_csi_1:liv_crisis_csi_3, 
                 liv_emerg_csi_1:liv_emerg_csi_4, 
                 liv_stress_csi_1:liv_stress_csi_4), 
            ~ case_when(.x == "yes" ~ 1, 
                        .x == "no_exhausted" ~ 1, 
                        TRUE ~ 0)) %>% 
  mutate(csi_weighted = 
           (liv_crisis_csi_1 + 
              liv_crisis_csi_2 +
              liv_crisis_csi_3) * .5 + 
           (liv_emerg_csi_1 + 
              liv_emerg_csi_2 +  
              liv_emerg_csi_4) * 1, 
         csi_weighted = range_wna(csi_weighted)) %>%
  ggplot(aes(x = csi_weighted)) + 
  geom_histogram(bins = 30) + 
  geom_freqpoly(binwidth = .2, 
                colour = "red",
                alpha = .7) + 
  labs(x = "Consumption score index (re-scaled), MSNA survey", 
       title = "Histograms of coping strategies index scores", 
                  subtitle = "REACH 2022")
```

<br>

There isn't enough defintion at the higher end of the scale. The FAO/WFP survey provides more detail in this case. 

<br> 


```{r}
survey %>% 
  mutate(csi_weighted = 
           (cs_crisis_sold_prod_assets +
              cs_crisis_no_school +
              cs_crisis_reduced_health_exp) * 0.5 + 
           (cs_emergency_sold_house + 
              cs_emergency_hh_migration + 
              cs_emergency_hh_risk) * 1,
         csi_weighted = range_wna(csi_weighted)) %>% 
  ggplot(aes(x = csi_weighted)) + 
  geom_histogram(bins = 30) + 
  geom_freqpoly(binwidth = .2, 
                colour = "red",
                alpha = .7) +
  labs(x = "Consumption score index (re-scaled), FAO/WFP survey", 
       title = "Histograms of coping strategies index scores", 
                  subtitle = "FAO/WFP 2022")
```

<br>

However, the IFPRI survey provides much more definition on the right-hand side of the scale. 
 

<br>

```{r fig.width = 7}

mini %>% 
  mutate(csi_weighted = range_wna(csi_weighted)) %>% 
  ggplot(aes(x = csi_weighted)) + 
  geom_histogram(bins = 30) + 
  geom_freqpoly(binwidth = .06, 
                colour = "red",
                alpha = .7) + 
  labs(title = "Histogram of coping strategies index scores", 
                  subtitle = "IFPRI 2022", 
       x = "Consumption score index (re-scaled), IFPRI survey",)

```


<br>

This added level of detail provides us with the shocking revelation that the number of households (in the IFPRI survey) who have reduced food expenditures to be at 56% of the unweighted population or 58% of the weighted population. 39% of the population have also borrowed food. 

```{r eval = FALSE}
mini %>% 
  left_join(ifpri_raw %>% 
              select(hhweight, hhid), 
            by = "hhid") %>% 
  group_by(k_10_reduced_food) %>% 
  summarise(count = n(), 
            hhweight = sum(hhweight), 
            csi_weighted = mean(csi_weighted, na.rm = TRUE)) %>% 
  mutate(pc = count / sum(count), 
         wt_pc = hhweight / sum(hhweight))


```

<br>

More so than the other index components, borrowing or reducing food seem to indicate greater problems and serves as an excellent way to distinguish the population in need. Coping strategies index scores are much higher for those who have reduced their food intake and have had to borrow food. 

This is especially applicable for targeting since we would be best served by looking at households who have reduced food intake or borrowed food and are above the, say, 75th percentile of scores for that group. 

<br>


```{r fig.width=7}
mini %>%
  mutate(reduce_borrow_food = ifelse(k_10_reduced_food == 1 | 
                                       k_11_borrow_food == 1, 
                                     "reduce_borrow_food", 
                                     "NOT_reduced_or_borrowed")) %>% 
  ggplot(aes(x = csi_weighted)) + 
  geom_histogram(bins = 30) + 
  geom_freqpoly(binwidth = .5, 
                colour = "red", 
                alpha = .7) + 
  facet_wrap(~ reduce_borrow_food) +
  labs(x = "Coping strategies index (weighted)", 
       y = "Number of households", 
       title = "Coping strategies indices of those who have reduced food consumption or borrowed food", 
       subtitle = "vs. those whos have not", 
       caption = "IFPRI 2022") +
  theme(legend.position = "none",
        strip.text = element_text(size = 10, face = "bold"),
        strip.background = element_rect(fill = "#212121"), 
        plot.title = element_text(size = 11))
```

```{r}
mini %>%
  filter(k_10_reduced_food == 1 | k_11_borrow_food == 1) %>% 
  ggplot(aes(x = csi_weighted)) + 
  geom_histogram(bins = 30) + 
  geom_freqpoly(binwidth = .5, 
                colour = "red", 
                alpha = .7) + 
  geom_vline(xintercept = 3.457287, 
             lty = 2, 
             colour = "blue", 
             size = 1.3, 
             alpha = .5) +
  geom_vline(xintercept = 4.5, 
             lty = 2, 
             colour = "blue", 
             size = 1.3, 
             alpha = .5) +  
  labs(x = "Coping strategies index (weighted)", 
       y = "Number of households", 
       title = "Coping strategies indices of those who have reduced food consumption or borrowed food", 
       subtitle = "First blue line shows the mean, the second the 75th percentile", 
       caption = "IFPRI 2022") +
  theme(legend.position = "none",
        strip.text = element_text(size = 10, face = "bold"),
        strip.background = element_rect(fill = "#212121"), 
        plot.title = element_text(size = 11))
  
```



<br><br>

### 5.2 Correlation plots -- CSI components

This section examines the relationships between the various components of the coping strategies index. 


<br>

```{r}
msna %>% 
  mutate_at(vars(liv_crisis_csi_1:liv_crisis_csi_3, 
                 liv_emerg_csi_1:liv_emerg_csi_4, 
                 liv_stress_csi_1:liv_stress_csi_4), 
            ~ case_when(.x == "yes" ~ 1, 
                        .x == "no_exhausted" ~ 1, 
                        TRUE ~ 0)) %>%
  select(sell_assets = liv_stress_csi_1, 
         spend_savings = liv_stress_csi_2, 
         borrow_food = liv_stress_csi_3, 
         sell_productive_assets = liv_crisis_csi_1, 
         reduce_health = liv_crisis_csi_2, 
         child_labour = liv_crisis_csi_3, 
         sell_house = liv_emerg_csi_1, 
         risky_activity = liv_emerg_csi_2, 
         migrate = liv_emerg_csi_4) %>% 
  cor(method = c("pearson")) %>% 
  corrplot(type = "upper", 
           col = colorRampPalette(brewer.pal(8, "RdBu"))(13), 
           tl.srt = 55, 
           title = "Correlation plot - coping strategies indicators, MSNA", 
           mar = c(0, 0, 2, 0), 
           diag = FALSE, 
           addCoef.col = 1, 
           number.cex = .3,
           tl.cex = .5)
  
```


<br>

In both IFPRI and the MSNA, borrowing food is associated the most with reductions in expenditures. 

<br>


```{r}

mini %>% 
  select(k_01_sell_assets,
           k_03_mortgage_assets, 
           k_05_consumed_seed_stock, 
           k_06_reduced_agriculture, 
           k_07_spend_savings, 
           k_08_reduced_healthcare, 
           k_09_reduced_nfi, 
           k_10_reduced_food, 
           k_11_borrow_food, 
           k_12_borrow_money, 
           k_13_migrate,
           k_14_children_work,
           k_15_risky_activity) %>% 
  rename_all(
    list(~ str_sub(.x, start = 6))) %>%
  cor(method = c("pearson")) %>% 
  corrplot(type = "upper", 
           col = colorRampPalette(brewer.pal(8, "RdBu"))(13),
           tl.srt = 55, 
           title = "Correlation plot - coping strategies indicators, IFPRI", 
           mar = c(0, 0, 2, 0), 
           diag = FALSE, 
           addCoef.col = 1, 
           number.cex = .3,
           tl.cex = .5)

```

<br>

We see this relationship preserved in the FAO/WFP survey results below.  

<br>

```{r}
survey %>% 
  select(matches("cs_")) %>% 
  select(-matches("fcs|raw")) %>% 
  select(1:13) %>% 
  rename_all(funs(
    str_sub(., start = 11)
  )) %>% 
  rename_all(funs(
    str_replace(., "cy_", "")
  )) %>%
  cor(method = c("pearson")) %>% 
  corrplot(type = "upper", 
           col = colorRampPalette(brewer.pal(8, "RdBu"))(13),
           tl.srt = 55, 
           title = "Correlation plot - coping strategies indicators, FAO/WFP", 
           mar = c(0, 0, 2, 0), 
           diag = FALSE, 
           addCoef.col = 1, 
           number.cex = .3,
           tl.cex = .5)
  
```

<br>

```{r eval = FALSE}
survey %>% 
  select(matches("cs_")) %>% 
  select(-matches("fcs|raw")) %>% 
  summarise(across(everything(), sum))

survey %>% nrow()

mini %>% 
  select(k_01_sell_assets,
           k_03_mortgage_assets, 
           k_05_consumed_seed_stock, 
           k_06_reduced_agriculture, 
           k_07_spend_savings, 
           k_08_reduced_healthcare, 
           k_09_reduced_nfi, 
           k_10_reduced_food, 
           k_11_borrow_food, 
           k_12_borrow_money, 
           k_13_migrate,
           k_14_children_work,
           k_15_risky_activity) %>%
  summarise(across(everything(), sum))

```


Analysing patterns related some of the emergency-level coping strategies indicators might not prove very fruitful. For instance, (thankfully) only 2.4% of households relied on sending their children to work as a coping strategy. The number of households engaging in risky activities was 7.8%. In IFPRI, these percentages were 3.7% and 5.2%, respectively. 

However, it is also immediately apparent how much more detail the full set of indicators (IFPRI and FAO/WFP) adds to this question, compared to the set used in the MSNA.



<br><br><br>




## 6. Next Steps

* Determine the level of interoperability between the FAO/WFP, IFPRI and MSNA datasets. Preparation for subsequent rounds of data collection and try to improve coordination between each of the surveys. 

* Work with other actors to develop updated vulnerability model -- maybe try clustering households again. 

* Exporatory data analysis will continue. 
